IF EXISTS (
		SELECT *
		FROM sysobjects
		WHERE type = 'P'
			AND NAME = 'USP_RP_GetSUBDTGetUsersByRole'
		)
BEGIN
	DROP PROCEDURE USP_RP_GetSUBDTGetUsersByRole;

	PRINT 'DROPPED USP_RP_GetSUBDTGetUsersByRole';
END
GO

/******************************************************************************                    
** OLD Name: USP_EIS_SUB_DT_GetUsersByRole_SelProc

** New Name: USP_RP_GetSUBDTGetUsersByRole  
                 
** Short Desc: 
**                    
** Full Description: 
**                            
** Input Arguments:   
**       
** Sample Call   
	EXEC USP_EIS_SUB_DT_GetUsersByRole_SelProc 1
**           
** Return values: Return Report Analyst Users based on Roles 
**                    
**                    
** Standard declarations                   
**                     
**                     
** Created By: Anand  
** Company   : Kaspick & Company                    
** Project   : Deliverable Tool                    
** Created DT: 27-Jan-2012              
**                                
*******************************************************************************              
**       Change History                    
*******************************************************************************              
** Date:        Author:  Bug #     Description:                           Rvwd              
** --------  -------- ------    -------------------------------------- --------              
** 13-04-2012	Ashvin			Rename @OwnerRole to @OwnerRoleID and using V_EIS_USER_ROLE view
** 21-May-2014  Mukesh			Made changes in the table and view names to refer new KASPICK DB
** 06-Jun-2014  Mukesh			SP Name Renamed and Formatted
*******************************************************************************                   
** Copyright (C) <CopyrightYear,,Year> Kaspick & Company, All Rights Reserved                    
** COMPANY CONFIDENTIAL -- NOT FOR DISTRIBUTION                    
*******************************************************************************/
CREATE PROCEDURE [dbo].[USP_RP_GetSUBDTGetUsersByRole] (@OwnerRoleID BIGINT = 0)
AS
BEGIN
	SELECT DISTINCT URV.UserID AS DDValue
		,URV.USER_NAME AS DDText
	FROM VW_EX_UserRole URV
	INNER JOIN TBL_KS_User UT ON UT.UserID = URV.UserID
	WHERE (
			@OwnerRoleID = 0
			OR MasterRoleID = @OwnerRoleID
			)
		AND UT.IsActive = 1
	ORDER BY URV.USER_NAME
END
GO

IF EXISTS (
		SELECT *
		FROM sysobjects
		WHERE type = 'P'
			AND NAME = 'USP_RP_GetSUBDTGetUsersByRole'
		)
BEGIN
	PRINT 'CREATED USP_RP_GetSUBDTGetUsersByRole';
END