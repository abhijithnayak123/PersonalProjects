IF EXISTS (SELECT *
           FROM   sysobjects 
           WHERE  type = 'P'
                  AND name = 'USP_EX_InsInvestmentComment')
    BEGIN
        DROP PROCEDURE USP_EX_InsInvestmentComment;
        PRINT 'DROPPED USP_EX_InsInvestmentComment';
    END
GO
  
/******************************************************************************        
** New Name : USP_EX_InsInvestmentComment
** Old Name   :   USP_EIS_EX_INVESTMENT_COMMENT_Insert  
** Short Desc : Inserts an Investment Comments record  
**        
** Full Description        
**                
**        
** Sample Call        
        EXEC USP_EIS_EX_INVESTMENT_COMMENT_Insert 'AdventID', "Investment Comments',   
             123, '2010-10-13 01:32:15.977',  
             123, '2010-10-13 01:32:15.977',  
   -- parameters        
**        
** Return values: InvestmentCommentID        
**        
**        
** Standard declarations        
**       SET LOCK_TIMEOUT         30000   -- 30 seconds        
**         
** Created By :  Prabin Varma   
** Company  :  Kaspick & Company        
** Project  :  Enfuego3B  
** Created DT :  Oct/13/2010        
**                    
*******************************************************************************        
**       Change History        
*******************************************************************************        
** Date:        Author:  Bug #     Description:                           Rvwd        
** --------     -------- ------    -------------------------------------- --------        
** 3-Apr-2014   Yugandhar EXCREQ 7.4
** 23/05/2014		Mallikarjun		SP Name Renamed and Formatted
******************************************************************************        
** Copyright (C) 2007 Kaspick & Company, All Rights Reserved        
** COMPANY CONFIDENTIAL -- NOT FOR DISTRIBUTION  
*******************************************************************************/   
CREATE PROCEDURE USP_EX_InsInvestmentComment   
 @AdventID VARCHAR(14),  
 @InvestmentComment TEXT,  
 @CreatedUser INT,  
 @CreateDate DATETIME,  
 @LastModifiedUser INT,  
 @LastModifiedDate DATETIME  
AS  
BEGIN  
 --  Initial Set statements  --      
 BEGIN TRY
 BEGIN TRANSACTION
 
 SET NOCOUNT ON;      
 SET LOCK_TIMEOUT                30000;   -- 30 seconds      
 --SET TRANSACTION ISOLATION LEVEL SNAPSHOT;  
  
 INSERT INTO TBL_INV_InvestmentComment  
  (CustomerAccountNumber,[InvestmentComment],[Createdby],[CreatedDate],[Modifiedby],[ModifiedDate])  
 VALUES  
  (@AdventID,@InvestmentComment,@CreatedUser,@CreateDate,@LastModifiedUser,@LastModifiedDate)  
  
 DECLARE @ReferenceID INT  
 SELECT @ReferenceID = @@IDENTITY  
  
 UPDATE TBL_INV_AccountProfile  
 SET InvestmentComment = @InvestmentComment  
 WHERE CustomerAccountNumber = @AdventID  
 
 COMMIT TRANSACTION
 
 RETURN @ReferenceID  
 
 END TRY

	BEGIN CATCH
		ROLLBACK TRANSACTION

		DECLARE @ProcName VARCHAR(60);
		DECLARE @ErrorMessage NVARCHAR(4000);
		DECLARE @ErrorSeverity INT;
		DECLARE @ErrorState INT;

		SET @ProcName = 'USP_EX_InsInvestmentComment';

		SELECT @ErrorMessage = ERROR_MESSAGE()
			,@ErrorSeverity = ERROR_SEVERITY()
			,@ErrorState = ERROR_STATE();

		RAISERROR (
				@ErrorMessage
				,-- Message text.
				@ErrorSeverity
				,-- Severity.
				@ErrorState -- State.
				);
	END CATCH
  
END  


GO
  IF EXISTS (	SELECT *
			FROM sysobjects
			WHERE type = 'P'
			AND name = 'USP_EX_InsInvestmentComment') 
	BEGIN
			PRINT 'CREATED PROCEDURE USP_EX_InsInvestmentComment';
	END 
  