IF EXISTS (
		SELECT *
		FROM sysobjects
		WHERE type = 'P'
			AND NAME = 'USP_EX_UpdWftAutopouplateBeneNameChange'
		)
BEGIN
	DROP PROCEDURE USP_EX_UpdWftAutopouplateBeneNameChange;

	PRINT 'DROPPED USP_EX_UpdWftAutopouplateBeneNameChange';
END
GO

/*************************************************************************************************************  
* Procedure Name  : USP_EX_UpdWftAutopouplateBeneNameChange
* Old Procedure Name  : sp_wft_autopouplate_BeneNameChange  
* Description     : This stored procedure is to update TRUST PARTICIPANT information  
     
** Sample Call  
  
* Modification Log                                               
*                              
* Date         Modified By  Description                                              
*-------------------------------------------------------------------------------------------------------------  
* 08-14-10		Tanuj		 Created	Special Project - TAG  
* 21-Mar-2014   Yugandhar    EXCREQ9.1 Modified    
* 23-MAY-2014  Mallikarjun     SP Name Renamed and Formatted                                  
**************************************************************************************************************/
CREATE PROCEDURE [dbo].[USP_EX_UpdWftAutopouplateBeneNameChange] @request_id INT
	,@user_id INT
AS
BEGIN
	BEGIN TRY --Start the Try Block..    
		--BEGIN TRANSACTION -- Start the transaction..   

		DECLARE @participantid INT
			,@Bene_Salutation VARCHAR(10)
			,@Bene_FirstName VARCHAR(20)
			,@Bene_MiddleName VARCHAR(4)
			,@Bene_LastName VARCHAR(50)
			,@Bene_PaymentName VARCHAR(100)

		SELECT @participantid = ContactID
			,@Bene_Salutation = donor_bene_salutation
			,@Bene_FirstName = donor_bene_first_name
			,@Bene_MiddleName = donor_bene_middle_name
			,@Bene_LastName = donor_bene_last_name
			,@Bene_PaymentName = payment_name
		FROM TBL_WFT_NameChange
		WHERE guid = (
				SELECT guid
				FROM TBL_WFT_Request
				WHERE request_id = @request_id
					AND formid = 91
				) --18586  

		--Salutation   
		SET @Bene_Salutation = (
				CASE 
					WHEN @Bene_Salutation = 'Cap.'
						THEN 'Captain'
					WHEN @Bene_Salutation = 'Gen.'
						THEN 'General'
					WHEN @Bene_Salutation = 'Maj..'
						THEN 'Major'
					WHEN @Bene_Salutation = 'Prof.'
						THEN 'Professor'
					END
				)

		--COMMIT TRANSACTION -- Transaction Success!    
	END TRY

	BEGIN CATCH
		DECLARE @ErrorMessage NVARCHAR(4000);
		DECLARE @ErrorSeverity INT;
		DECLARE @ErrorState INT;

		SELECT @ErrorMessage = ERROR_MESSAGE()
			,@ErrorSeverity = ERROR_SEVERITY()
			,@ErrorState = ERROR_STATE();

		RAISERROR (
				@ErrorMessage
				,-- Message text.
				@ErrorSeverity
				,-- Severity.
				@ErrorState -- State.
				);
			  
	END CATCH
END
GO

IF EXISTS (
		SELECT *
		FROM sysobjects
		WHERE type = 'P'
			AND NAME = 'USP_EX_UpdWftAutopouplateBeneNameChange'
		)
BEGIN
	PRINT 'CREATED PROCEDURE USP_EX_UpdWftAutopouplateBeneNameChange';
END