
IF EXISTS (SELECT *
           FROM   sysobjects 
           WHERE  type = 'P'
                  AND name = 'USP_EX_GetProgramCl')
    BEGIN
        DROP PROCEDURE USP_EX_GetProgramCl;
        PRINT 'DROPPED USP_EX_GetProgramCl';
    END
GO

  
/*********************************************************************************************************************                                                             
* PROCEDURE NAME : USP_EX_GetProgramCl  
* OLD PROCEDURE NAME : USP_EX_GetProgramCl                     
* DESCRIPTION    : TO RETRIEVE PROGRAM HEADER DETAILS.                    
* INPUT          : @CLIENTID: PROGRAM ID, OF WHICH THE DETAILS SHOULD BE FETCHED.                    
* MODIFICATION LOG                                                                 
*                                                
* DATE   MODIFIED BY  DESCRIPTION                                                                
*--------------------------------------------------------------------------------------------------------------------                                                             
* 15-NOV-06  VSHIVHARE  CREATED                    
* 12-MAR-07  VSHIVAHER MODIFIED FOR NOT DISPLAYING INACTIVE CLIENT     
*24-Feb-14   Sanath modified for Program module for 6.1 requirment  
* 23/05/2014 Mallikarjun  SP Name Renamed and Formatted                 
*********************************************************************************************************************/     
CREATE PROCEDURE [dbo].[USP_EX_GetProgramCl] --100260                   
 @USER_ID INT                         
AS                            
BEGIN                            
DECLARE @STATUS_ID INT            
            
 EXEC USP_EX_GetListItemID
  @LIST_TYPE_NAME = 'STATUS',              
  @LIST_ITEM_NAME = 'INACTIVE',              
  @LIST_ITEM_ID = @STATUS_ID OUTPUT                 
  
SELECT DISTINCT                            
 AccMgrCds.ManagerCode,                            
 ISNULL(AccMgrCds.ManagerCode,'') CL_BRIEFNAME                           
 FROM                             
 SYN_IT_AccountManagerCodes AccMgrCds                             
 where AccMgrCds.ManagerCode =(  
 SELECT TOP 1 AccMgrCds.ManagerCode  
        FROM SYN_IT_ContactMaster ConMstr  
        INNER JOIN SYN_IT_AccountManagerCodes AccMgrCds ON ConMstr.ContactID=AccMgrCds.ContactID  
        INNER JOIN SYN_IT_SubContactRoles subConRol ON subConRol.ContactID=ConMstr.ContactID  
        INNER JOIN SYN_IT_ContactRoleCodes ConRolCds ON ConRolCds.Id=subConRol.ContactRoleCode  
        INNER JOIN SYN_IT_ContactMaster KcoStfConMstr ON KcoStfConMstr.contactID=subConRol.subcontactID  
        INNER JOIN TBL_KS_User KsUsr ON KsUsr.InnotrustContactID = KcoStfConMstr.contactID  
        WHERE  
          subConRol.ContactRoleCode IN (2)  
          AND KsUsr.USERID = @USER_ID)   
 ORDER BY  CL_BRIEFNAME              
END        
    
    
GO
  IF EXISTS (	SELECT *
			FROM sysobjects
			WHERE type = 'P'
			AND name = 'USP_EX_GetProgramCl') 
	BEGIN
			PRINT 'CREATED PROCEDURE USP_EX_GetProgramCl';
	END