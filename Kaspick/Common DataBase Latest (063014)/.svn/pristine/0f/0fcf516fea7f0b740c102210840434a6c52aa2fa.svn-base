
IF EXISTS (SELECT *
           FROM   sysobjects 
           WHERE  type = 'P'
                  AND name = 'USP_EX_GetProgramClHdr')
    BEGIN
        DROP PROCEDURE USP_EX_GetProgramClHdr;
        PRINT 'DROPPED USP_EX_GetProgramClHdr';
    END
GO

    
/*********************************************************************************************************************                                                     
* Procedure Name : USP_EX_GetProgramClHdr  
* Old Procedure Name : USP_EX_GetProgramClHdr             
* Description    : To retrieve PROGRAM Header Details.            
* Input          : @CLIENTID: Program Id, of which the details should be fetched.            
* Modification Log                                                         
*                                        
* Date   Modified By  Description                                                        
*--------------------------------------------------------------------------------------------------------------------                                                     
* 15-Nov-06  Vshivhare  Created            
* 05-Dec-07  Vshivhare  modified for returning one more output column(association flag)  
* 15-Apr-14  Sanath     EXCREQ 6.4        
* 23/05/2014 Mallikarjun  SP Name Renamed and Formatted         
*********************************************************************************************************************/                
CREATE PROCEDURE [dbo].[USP_EX_GetProgramClHdr]       
(                
 @CLIENTID VARCHAR(15),      
 @USERID INT              
)                
AS                
                
BEGIN                
                
SELECT                 
 AccMgrCds.ManagerCode AS CLIENTID,                
 ISNULL(AccMgrCds.ManagerCode,'') CL_BRIEFNAME,                
 ISNULL(ConMstr.ContactName,'') CL_FULLNAME,        
 ISNULL(AccMstr.TaxIDNumber,'') CL_TAXID,      
 ASSOCIATION=CASE WHEN (SELECT TOP 1 AccMgrCds.ManagerCode  
        FROM SYN_IT_ContactMaster ConMstr  
        INNER JOIN SYN_IT_AccountManagerCodes AccMgrCds ON ConMstr.ContactID=AccMgrCds.ContactID  
        INNER JOIN SYN_IT_SubContactRoles subConRol ON subConRol.ContactID=ConMstr.ContactID  
        INNER JOIN SYN_IT_ContactRoleCodes ConRolCds ON ConRolCds.Id=subConRol.ContactRoleCode  
        INNER JOIN SYN_IT_ContactMaster KcoStfConMstr ON KcoStfConMstr.contactID=subConRol.subcontactID  
        INNER JOIN TBL_KS_User KsUsr ON KsUsr.InnotrustContactID = KcoStfConMstr.contactID  
        WHERE  
          subConRol.ContactRoleCode IN (2)--,3,518,26,34,512,519,515,510 -- 2 is Administrator  
          AND KsUsr.USERID = @USERID)          
    IS NULL THEN 1 ELSE 1 END                  
 FROM                 
 SYN_IT_AccountManagerCodes AccMgrCds     
 INNER JOIN SYN_IT_AccountMaster AccMstr ON AccMstr.ManagerCode=AccMgrCds.ManagerCode    
 INNER JOIN SYN_IT_ContactMaster ConMstr ON ConMstr.ContactID=AccMgrCds.ContactID            
WHERE                 
 AccMgrCds.ManagerCode = @CLIENTID                
                 
END 




GO
  IF EXISTS (	SELECT *
			FROM sysobjects
			WHERE type = 'P'
			AND name = 'USP_EX_GetProgramClHdr') 
	BEGIN
			PRINT 'CREATED PROCEDURE USP_EX_GetProgramClHdr';
	END
  