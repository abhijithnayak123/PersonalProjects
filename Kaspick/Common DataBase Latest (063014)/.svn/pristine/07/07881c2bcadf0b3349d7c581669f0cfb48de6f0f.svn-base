/****** Object:  StoredProcedure [dbo].[USP_IE_ImportSaveSTGSecurities]    Script Date: 07/02/2014 09:22:21 ******/
IF EXISTS (
		SELECT 1
		FROM sys.objects
		WHERE object_id = OBJECT_ID(N'[dbo].[USP_IE_ImportSaveSTGSecurities]')
			AND type IN (
				N'P'
				,N'PC'
				)
		)
	DROP PROCEDURE [dbo].[USP_IE_ImportSaveSTGSecurities]
GO

/****** Object:  StoredProcedure [dbo].[USP_IE_ImportSaveSTGSecurities]    Script Date: 07/02/2014 09:22:21 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

/******************************************************************************    
** Name:     USP_IE_ImportSaveSTGSecurities    
** Short Desc:  Imports all Axys Securities into security staging table TBL_IE_STG_Securities
**    
** Full Description : Imports all Axys Securities into security staging table TBL_IE_STG_Securities
**            
**    
** Sample Call    
DECLARE @XMLDATA XML
	
	SET @XMLDATA = 
	'<StgSecuritiesCollection><InsertList>
		<StgSecurities SecurityID="0"  Type="agus"  Symbol="00207G105"  CUSIPOther=""  DescriptionName="Art Int&apos;l Corporation"  DescriptionBondName=""  AssetClass=""  IndustryGroup="2"  IndustrySector="1"  Exchange="0"  RiskCountry=""  IssueCountry=""  Reserved1=""  TradesWithAccruedInterest=""  ZeroCoupon=""  PaysOnMonthEnd=""  IssuePrice=""  DTCIDNumber=""  DividendRateInterestRate="0"  AccrualCalendar=""  PaymentFrequencyCouponFrequency="0"  PoolNumber=""  CouponDelay=""  SPRating=""  MoodyRating=""  AverageLife=""  YTMOnMkt=""  YTMOnCost=""  Duration=""  RevenueSource=""  BondInsurer=""  BondStatus=""  Reserved2=""  Reserved3=""  CallPrice1=""  CallPrice2=""  CallPrice3=""  PutPrice=""  State=""  Brokerage=""  AvailableToTrade=""  SecurityUserDefined1=""  SecurityUserDefined2="0"  SecurityUserDefined3=""  Reserved4=""  Reserved5=""  CMO=""  ResetRule=""  ResetPeriodicity=""  ResetHolidayAdjustment=""  ResetOffset=""  CouponRule=""  CouponPeriodicity=""  CouponHolidayAdjustment=""  ResetBaseRate=""  ResetBaseMultiplier=""  ResetAdder=""  PutScheduleMethod=""  ResetMethod=""  CouponMethod=""  Reserved6=""  ValuationFactor=""  PutScheduleRule=""  PutSchedulePeriod=""  PutScheduleBankHoliday=""  Reserved7=""  Reserved8=""  Perpetual=""  ImportDate="10/1/2007 5:14:40 PM"  UserID="1"  UserName="Administrator"  />
		<StgSecurities SecurityID="0"  Type="agus"  Symbol="011694684"  CUSIPOther=""  DescriptionName="Alaska Energy and Resources Company"  DescriptionBondName=""  AssetClass=""  IndustryGroup="2"  IndustrySector="1"  Exchange="0"  RiskCountry=""  IssueCountry=""  Reserved1="y"  TradesWithAccruedInterest=""  ZeroCoupon=""  PaysOnMonthEnd=""  IssuePrice=""  DTCIDNumber=""  DividendRateInterestRate="2.2"  AccrualCalendar=""  PaymentFrequencyCouponFrequency="0"  PoolNumber=""  CouponDelay=""  SPRating=""  MoodyRating=""  AverageLife=""  YTMOnMkt=""  YTMOnCost=""  Duration=""  RevenueSource=""  BondInsurer=""  BondStatus=""  Reserved2=""  Reserved3=""  CallPrice1=""  CallPrice2=""  CallPrice3=""  PutPrice=""  State=""  Brokerage=""  AvailableToTrade=""  SecurityUserDefined1=""  SecurityUserDefined2="0"  SecurityUserDefined3=""  Reserved4=""  Reserved5=""  CMO=""  ResetRule=""  ResetPeriodicity=""  ResetHolidayAdjustment=""  ResetOffset=""  CouponRule=""  CouponPeriodicity=""  CouponHolidayAdjustment=""  ResetBaseRate=""  ResetBaseMultiplier=""  ResetAdder=""  PutScheduleMethod=""  ResetMethod=""  CouponMethod=""  Reserved6=""  ValuationFactor=""  PutScheduleRule=""  PutSchedulePeriod=""  PutScheduleBankHoliday=""  Reserved7=""  Reserved8=""  Perpetual=""  ImportDate="10/1/2007 5:14:40 PM"  UserID="1"  UserName="Administrator"  />
		<StgSecurities SecurityID="0"  Type="agus"  Symbol="045919107"  CUSIPOther=""  DescriptionName="At Home Corp."  DescriptionBondName=""  AssetClass=""  IndustryGroup="2"  IndustrySector="1"  Exchange="0"  RiskCountry=""  IssueCountry=""  Reserved1=""  TradesWithAccruedInterest=""  ZeroCoupon=""  PaysOnMonthEnd=""  IssuePrice=""  DTCIDNumber=""  DividendRateInterestRate="0"  AccrualCalendar=""  PaymentFrequencyCouponFrequency="0"  PoolNumber=""  CouponDelay=""  SPRating=""  MoodyRating=""  AverageLife=""  YTMOnMkt=""  YTMOnCost=""  Duration=""  RevenueSource=""  BondInsurer=""  BondStatus=""  Reserved2=""  Reserved3=""  CallPrice1=""  CallPrice2=""  CallPrice3=""  PutPrice=""  State=""  Brokerage=""  AvailableToTrade=""  SecurityUserDefined1=""  SecurityUserDefined2="0"  SecurityUserDefined3=""  Reserved4=""  Reserved5=""  CMO=""  ResetRule=""  ResetPeriodicity=""  ResetHolidayAdjustment=""  ResetOffset=""  CouponRule=""  CouponPeriodicity=""  CouponHolidayAdjustment=""  ResetBaseRate=""  ResetBaseMultiplier=""  ResetAdder=""  PutScheduleMethod=""  ResetMethod=""  CouponMethod=""  Reserved6=""  ValuationFactor=""  PutScheduleRule=""  PutSchedulePeriod=""  PutScheduleBankHoliday=""  Reserved7=""  Reserved8=""  Perpetual=""  ImportDate="10/1/2007 5:14:40 PM"  UserID="1"  UserName="Administrator"  />
		<StgSecurities SecurityID="0"  Type="agus"  Symbol="29014Q105"  CUSIPOther=""  DescriptionName="Elot Inc. Del"  DescriptionBondName=""  AssetClass=""  IndustryGroup="2"  IndustrySector="1"  Exchange="0"  RiskCountry=""  IssueCountry=""  Reserved1=""  TradesWithAccruedInterest=""  ZeroCoupon=""  PaysOnMonthEnd=""  IssuePrice=""  DTCIDNumber=""  DividendRateInterestRate="0"  AccrualCalendar=""  PaymentFrequencyCouponFrequency="0"  PoolNumber=""  CouponDelay=""  SPRating=""  MoodyRating=""  AverageLife=""  YTMOnMkt=""  YTMOnCost=""  Duration=""  RevenueSource=""  BondInsurer=""  BondStatus=""  Reserved2=""  Reserved3=""  CallPrice1=""  CallPrice2=""  CallPrice3=""  PutPrice=""  State=""  Brokerage=""  AvailableToTrade=""  SecurityUserDefined1=""  SecurityUserDefined2="0"  SecurityUserDefined3=""  Reserved4=""  Reserved5=""  CMO=""  ResetRule=""  ResetPeriodicity=""  ResetHolidayAdjustment=""  ResetOffset=""  CouponRule=""  CouponPeriodicity=""  CouponHolidayAdjustment=""  ResetBaseRate=""  ResetBaseMultiplier=""  ResetAdder=""  PutScheduleMethod=""  ResetMethod=""  CouponMethod=""  Reserved6=""  ValuationFactor=""  PutScheduleRule=""  PutSchedulePeriod=""  PutScheduleBankHoliday=""  Reserved7=""  Reserved8=""  Perpetual=""  ImportDate="10/1/2007 5:14:40 PM"  UserID="1"  UserName="Administrator"  />
		<StgSecurities SecurityID="0"  Type="agus"  Symbol="293018107"  CUSIPOther=""  DescriptionName="Englewood Bank &amp; Trust"  DescriptionBondName=""  AssetClass=""  IndustryGroup="2"  IndustrySector="1"  Exchange="0"  RiskCountry=""  IssueCountry=""  Reserved1="y"  TradesWithAccruedInterest=""  ZeroCoupon=""  PaysOnMonthEnd=""  IssuePrice=""  MaturityDateNextPaymentDate="7/15/1982 12:00:00 AM"  DTCIDNumber=""  DividendRateInterestRate="0"  AccrualCalendar=""  PaymentFrequencyCouponFrequency="0"  PoolNumber=""  CouponDelay=""  SPRating=""  MoodyRating=""  AverageLife=""  YTMOnMkt=""  YTMOnCost=""  Duration=""  RevenueSource=""  BondInsurer=""  BondStatus=""  Reserved2=""  Reserved3=""  CallPrice1=""  CallPrice2=""  CallPrice3=""  PutPrice=""  State=""  Brokerage=""  AvailableToTrade=""  SecurityUserDefined1=""  SecurityUserDefined2="1"  SecurityUserDefined3=""  Reserved4=""  Reserved5=""  CMO=""  ResetRule=""  ResetPeriodicity=""  ResetHolidayAdjustment=""  ResetOffset=""  CouponRule=""  CouponPeriodicity=""  CouponHolidayAdjustment=""  ResetBaseRate=""  ResetBaseMultiplier=""  ResetAdder=""  PutScheduleMethod=""  ResetMethod=""  CouponMethod=""  Reserved6=""  ValuationFactor=""  PutScheduleRule=""  PutSchedulePeriod=""  PutScheduleBankHoliday=""  Reserved7=""  Reserved8=""  Perpetual=""  ImportDate="10/1/2007 5:14:40 PM"  UserID="1"  UserName="Administrator"  />
		<StgSecurities SecurityID="0"  Type="mbus"  Symbol="130621DQ5"  CUSIPOther=""  DescriptionName=""  DescriptionBondName="CA State GO"  AssetClass=""  IndustryGroup="10"  IndustrySector="140"  Exchange="0"  RiskCountry=""  IssueCountry=""  Reserved1=""  TradesWithAccruedInterest=""  ZeroCoupon=""  PaysOnMonthEnd=""  IssuePrice=""  IssueDateDatedDate="6/1/1980 12:00:00 AM"  FirstCouponDate="2/1/1981 12:00:00 AM"  MaturityDateNextPaymentDate="8/1/2000 12:00:00 AM"  DTCIDNumber=""  DividendRateInterestRate="7.25"  AccrualCalendar=""  PaymentFrequencyCouponFrequency="0"  PoolNumber=""  CouponDelay=""  SPRating="AA-"  MoodyRating="AA3"  AverageLife=""  YTMOnMkt=""  YTMOnCost=""  Duration=""  RevenueSource=""  BondInsurer=""  BondStatus=""  Reserved2=""  Reserved3=""  CallPrice1=""  CallPrice2=""  CallPrice3=""  PutPrice=""  State="ca"  Brokerage=""  AvailableToTrade=""  SecurityUserDefined1=""  SecurityUserDefined2="0"  SecurityUserDefined3=""  Reserved4=""  Reserved5=""  CMO=""  ResetRule=""  ResetPeriodicity=""  ResetHolidayAdjustment=""  ResetOffset=""  CouponRule=""  CouponPeriodicity=""  CouponHolidayAdjustment=""  ResetBaseRate=""  ResetBaseMultiplier=""  ResetAdder=""  PutScheduleMethod=""  ResetMethod=""  CouponMethod=""  Reserved6=""  ValuationFactor=""  PutScheduleRule=""  PutSchedulePeriod=""  PutScheduleBankHoliday=""  Reserved7=""  Reserved8=""  Perpetual=""  ImportDate="10/1/2007 5:14:41 PM"  UserID="1"  UserName="Administrator"  />
	</InsertList><UpdateList></UpdateList><DeleteList></DeleteList>
	</StgSecuritiesCollection>'
	
    EXEC USP_IE_ImportSaveSTGSecurities @XMLDATA  
**    
** Return values: NONE    
**    
**    
** Standard declarations    
**       SET LOCK_TIMEOUT         30000   -- 30 seconds    
**     
** Created By: Mohamed Salih    
** Company   : Kaspick & Company    
** Project   : Back Office Integration - Income Estimation    
** Created DT: 07/15/2014    
**                
*******************************************************************************    
**       Change History    
*******************************************************************************    
** Date:        Author:  Bug #     Description:                           Rvwd    
** --------     -------- ------    -------------------------------------- --------    
**   
*******************************************************************************    
** Copyright (C) <CopyrightYear,,Year> Kaspick & Company, All Rights Reserved    
** COMPANY CONFIDENTIAL -- NOT FOR DISTRIBUTION    
*******************************************************************************/
CREATE PROCEDURE [dbo].[USP_IE_ImportSaveSTGSecurities]  @XMLDATA XML
AS

BEGIN
	SET NOCOUNT ON;
	SET LOCK_TIMEOUT 30000;-- 30 seconds    

	BEGIN TRY
		BEGIN TRANSACTION
		
		-- Removes the table records
		DELETE
		FROM TBL_IE_STG_Securities
		
		-- Loading Xml input
		INSERT INTO TBL_IE_STG_Securities (
			[Type]
			,Symbol
			,CUSIPOther
			,DescriptionName
			,DescriptionBondName
			,AssetClass
			,IndustryGroup
			,IndustrySector
			,Exchange
			,RiskCountry
			,IssueCountry
			,Reserved1
			,TradesWithAccruedInterest
			,ZeroCoupon
			,PaysOnMonthEnd
			,RecordDate
			,IssuePrice
			,IssueDateDatedDate
			,FirstCouponDate
			,LastCouponDate
			,MaturityDateNextPaymentDate
			,EstimatedMaturityDate
			,DTCIDNumber
			,DividendRateInterestRate
			,AccrualCalendar
			,PaymentFrequencyCouponFrequency
			,PoolNumber
			,CouponDelay
			,SPRating
			,MoodyRating
			,AverageLife
			,YTMOnMkt
			,YTMOnCost
			,Duration
			,RevenueSource
			,BondInsurer
			,BondStatus
			,Reserved2
			,Reserved3
			,CallDate1
			,CallPrice1
			,CallDate2
			,CallPrice2
			,CallDate3
			,CallPrice3
			,PutDate
			,PutPrice
			,[State]
			,Brokerage
			,AvailableToTrade
			,SecurityUserDefined1
			,SecurityUserDefined2
			,SecurityUserDefined3
			,Reserved4
			,Reserved5
			,CMO
			,ResetRule
			,ResetPeriodicity
			,ResetHolidayAdjustment
			,ResetOffset
			,CouponRule
			,CouponPeriodicity
			,CouponHolidayAdjustment
			,ResetBaseRate
			,ResetBaseMultiplier
			,ResetAdder
			,PutScheduleMethod
			,ResetDate
			,ResetMethod
			,CouponMethod
			,Reserved6
			,ValuationFactor
			,PutScheduleRule
			,PutSchedulePeriod
			,PutScheduleBankHoliday
			,PutScheduleFirstDate
			,Reserved7
			,Reserved8
			,Perpetual
			,ImportDate
			,UserID
			,UserName
			)
		SELECT XmlInput.Item.value('@Type[1]', 'varchar(10)') AS [Type]
			,XmlInput.Item.value('@Symbol[1]', 'varchar(10)') AS Symbol
			,XmlInput.Item.value('@CUSIPOther[1]', 'varchar(10)') AS CUSIPOther
			,XmlInput.Item.value('@DescriptionName[1]', 'varchar(100)') AS DescriptionName
			,XmlInput.Item.value('@DescriptionBondName[1]', 'varchar(100)') AS DescriptionBondName
			,XmlInput.Item.value('@AssetClass[1]', 'varchar(2)') AS AssetClass
			,XmlInput.Item.value('@IndustryGroup[1]', 'int') AS IndustryGroup
			,XmlInput.Item.value('@IndustrySector[1]', 'int') AS IndustrySector
			,XmlInput.Item.value('@Exchange[1]', 'int') AS Exchange
			,XmlInput.Item.value('@RiskCountry[1]', 'varchar(20)') AS RiskCountry
			,XmlInput.Item.value('@IssueCountry[1]', 'varchar(20)') AS IssueCountry
			,XmlInput.Item.value('@Reserved1[1]', 'varchar(20)') AS Reserved1
			,XmlInput.Item.value('@TradesWithAccruedInterest[1]', 'varchar(20)') AS TradesWithAccruedInterest
			,XmlInput.Item.value('@ZeroCoupon[1]', 'varchar(20)') AS ZeroCoupon
			,XmlInput.Item.value('@PaysOnMonthEnd[1]', 'varchar(20)') AS PaysOnMonthEnd
			,XmlInput.Item.value('@RecordDate[1]', 'datetime') AS RecordDate
			,XmlInput.Item.value('@IssuePrice[1]', 'varchar(20)') AS IssuePrice
			,XmlInput.Item.value('@IssueDateDatedDate[1]', 'datetime') AS IssueDateDatedDate
			,XmlInput.Item.value('@FirstCouponDate[1]', 'datetime') AS FirstCouponDate
			,XmlInput.Item.value('@LastCouponDate[1]', 'datetime') AS LastCouponDate
			,XmlInput.Item.value('@MaturityDateNextPaymentDate[1]', 'datetime') AS MaturityDateNextPaymentDate
			,XmlInput.Item.value('@EstimatedMaturityDate[1]', 'datetime') AS EstimatedMaturityDate
			,XmlInput.Item.value('@DTCIDNumber[1]', 'varchar(20)') AS DTCIDNumber
			,XmlInput.Item.value('@DividendRateInterestRate[1]', 'float') AS DividendRateInterestRate
			,XmlInput.Item.value('@AccrualCalendar[1]', 'varchar(20)') AS AccrualCalendar
			,XmlInput.Item.value('@PaymentFrequencyCouponFrequency[1]', 'int') AS PaymentFrequencyCouponFrequency
			,XmlInput.Item.value('@PoolNumber[1]', 'varchar(20)') AS PoolNumber
			,XmlInput.Item.value('@CouponDelay[1]', 'varchar(20)') AS CouponDelay
			,XmlInput.Item.value('@SPRating[1]', 'varchar(20)') AS SPRating
			,XmlInput.Item.value('@MoodyRating[1]', 'varchar(20)') AS MoodyRating
			,XmlInput.Item.value('@AverageLife[1]', 'varchar(20)') AS AverageLife
			,XmlInput.Item.value('@YTMOnMkt[1]', 'varchar(20)') AS YTMOnMkt
			,XmlInput.Item.value('@YTMOnCost[1]', 'varchar(20)') AS YTMOnCost
			,XmlInput.Item.value('@Duration[1]', 'varchar(20)') AS Duration
			,XmlInput.Item.value('@RevenueSource[1]', 'varchar(20)') AS RevenueSource
			,XmlInput.Item.value('@BondInsurer[1]', 'varchar(20)') AS BondInsurer
			,XmlInput.Item.value('@BondStatust[1]', 'varchar(20)') AS BondStatus
			,XmlInput.Item.value('@Reserved2[1]', 'varchar(20)') AS Reserved2
			,XmlInput.Item.value('@Reserved3[1]', 'varchar(20)') AS Reserved3
			,XmlInput.Item.value('@CallDate1[1]', 'datetime') AS CallDate1
			,XmlInput.Item.value('@CallPrice1[1]', 'varchar(20)') AS CallPrice1
			,XmlInput.Item.value('@CallDate2[1]', 'datetime') AS CallDate2
			,XmlInput.Item.value('@CallPrice2[1]', 'varchar(20)') AS CallPrice2
			,XmlInput.Item.value('@CallDate3[1]', 'datetime') AS CallDate3
			,XmlInput.Item.value('@CallPrice3[1]', 'varchar(20)') AS CallPrice3
			,XmlInput.Item.value('@PutDate[1]', 'datetime') AS PutDate
			,XmlInput.Item.value('@PutPrice[1]', 'varchar(20)') AS PutPrice
			,XmlInput.Item.value('@State[1]', 'varchar(20)') AS [State]
			,XmlInput.Item.value('@Brokerage[1]', 'varchar(20)') AS Brokerage
			,XmlInput.Item.value('@AvailableToTrade[1]', 'varchar(20)') AS AvailableToTrade
			,XmlInput.Item.value('@SecurityUserDefined1[1]', 'varchar(20)') AS SecurityUserDefined1
			,XmlInput.Item.value('@SecurityUserDefined2[1]', 'int') AS SecurityUserDefined2
			,XmlInput.Item.value('@SecurityUserDefined3[1]', 'varchar(20)') AS SecurityUserDefined3
			,XmlInput.Item.value('@Reserved4[1]', 'varchar(20)') AS Reserved4
			,XmlInput.Item.value('@Reserved5[1]', 'varchar(20)') AS Reserved5
			,XmlInput.Item.value('@CMO[1]', 'varchar(20)') AS CMO
			,XmlInput.Item.value('@ResetRule[1]', 'varchar(20)') AS ResetRule
			,XmlInput.Item.value('@ResetPeriodicity[1]', 'varchar(20)') AS ResetPeriodicity
			,XmlInput.Item.value('@ResetHolidayAdjustment[1]', 'varchar(20)') AS ResetHolidayAdjustment
			,XmlInput.Item.value('@ResetOffset[1]', 'varchar(20)') AS ResetOffset
			,XmlInput.Item.value('@CouponRule[1]', 'varchar(20)') AS CouponRule
			,XmlInput.Item.value('@CouponPeriodicity[1]', 'varchar(20)') AS CouponPeriodicity
			,XmlInput.Item.value('@CouponHolidayAdjustment[1]', 'varchar(20)') AS CouponHolidayAdjustment
			,XmlInput.Item.value('@ResetBaseRate[1]', 'varchar(20)') AS ResetBaseRate
			,XmlInput.Item.value('@ResetBaseMultiplier[1]', 'varchar(20)') AS ResetBaseMultiplier
			,XmlInput.Item.value('@ResetAdder[1]', 'varchar(20)') AS ResetAdder
			,XmlInput.Item.value('@PutScheduleMethod[1]', 'varchar(20)') AS PutScheduleMethod
			,XmlInput.Item.value('@ResetDate[1]', 'datetime') AS ResetDate
			,XmlInput.Item.value('@ResetMethod[1]', 'varchar(20)') AS ResetMethod
			,XmlInput.Item.value('@CouponMethod[1]', 'varchar(20)') AS CouponMethod
			,XmlInput.Item.value('@Reserved6[1]', 'varchar(20)') AS Reserved6
			,XmlInput.Item.value('@ValuationFactor[1]', 'varchar(20)') AS ValuationFactor
			,XmlInput.Item.value('@PutScheduleRule[1]', 'varchar(20)') AS PutScheduleRule
			,XmlInput.Item.value('@PutSchedulePeriod[1]', 'varchar(20)') AS PutSchedulePeriod
			,XmlInput.Item.value('@PutScheduleBankHoliday[1]', 'varchar(20)') AS PutScheduleBankHoliday
			,XmlInput.Item.value('@PutScheduleFirstDate[1]', 'datetime') AS PutScheduleFirstDate
			,XmlInput.Item.value('@Reserved7[1]', 'varchar(20)') AS Reserved7
			,XmlInput.Item.value('@Reserved8[1]', 'varchar(20)') AS Reserved8
			,XmlInput.Item.value('@Perpetual[1]', 'varchar(20)') AS Perpetual
			,XmlInput.Item.value('@ImportDate[1]', 'datetime') AS ImportDate
			,XmlInput.Item.value('@UserID[1]', 'int') AS UserID
			,XmlInput.Item.value('@UserName[1]', 'varchar(50)') AS UserName
		FROM @XMLDATA.nodes('//StgSecuritiesCollection/InsertList/StgSecurities') AS XmlInput(Item)

		COMMIT TRANSACTION;
	END TRY

	BEGIN CATCH
		ROLLBACK TRANSACTION;

		DECLARE @ErrorMessage NVARCHAR(4000);
		DECLARE @ErrorSeverity INT;
		DECLARE @ErrorState INT;

		SELECT @ErrorMessage = ERROR_MESSAGE()
			,@ErrorSeverity = ERROR_SEVERITY()
			,@ErrorState = ERROR_STATE();

		RAISERROR (
				@ErrorMessage
				,-- Message text.
				@ErrorSeverity
				,-- Severity.
				@ErrorState -- State.
				);

		PRINT N'The transaction is in an uncommittable state. ' + 'Rolling back transaction.'
	END CATCH

	SET NOCOUNT OFF;
END
