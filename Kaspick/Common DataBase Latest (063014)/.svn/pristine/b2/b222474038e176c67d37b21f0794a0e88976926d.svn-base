DELETE FROM TBL_POLICYITEM
WHERE POLICYDIMENSIONID IN (
		SELECT DISTINCT policydimensionid
		FROM TBL_PolicyDimension
		WHERE Fullname IN (
				'Client Name'
				,'TARP FCB Rollover'
				,'TARP Mkt Value Roll.'
				,'TARP Data Extract'
				,'Rpt Schedule'
				,'Mon Bene Rpt Prn set'
				,'Qtrly report copies'
				,'SAnn Ben Rpt Prnset'
				,'Ann Bene Rpt Copies'
				,'Ann Don Rpt Prn set'
				,'Mon Publish to Web'
				,'Qtr Publish to Web'
				,'SAnn Publish to Web'
				,'Ann Publish to Web'
				,'PIF Key Statistics'
				,'PIF Account History'
				,'PIF Unit Dec Prec'
				,'Payment Summary'
				,'Ann Acct History'
				,'Ann Alloc Summary'
				,'Ann Perf Summary'
				,'Per Perf Summary'
				,'Ann Portfolio App'
				,'Per Portfolio App'
				,'Cli Acct # on Rpts'
				,'Spigot Special Page'
				,'Min Req Dist (DAF)'
				,'Donor Advised Fund'
				,'Client Color Scheme'
				,'Client Logo'
				,'Client Contact'
				,'Mon DVD copies'
				,'Qtr DVD copies'
				,'SAnn DVD copies'
				,'No. of CD - Ann Rpt'
				,'Prior Period Adj'
				,'Custom label'
				,'TARP Prod. Cycle'
				,'TARP Calendar'
				,'CTS Production'
				,'Perf Net of Fees'
				,'Comp. Statistics Rpt'
				,'Exc from Rpt Medians'
				,'CTS Client Policy'
				,'PV Rpt by Acct Type'
				,'PV Rpt by Designatn'
				,'Retirement/Perpetual'
				,'Srt dt for perform.'
				,'Display Pmt Report'
				,'K-1 MAILING RULE'
				,'Trustee Change Date'
				,'Tax Return Ext. Date'
				,'Account Transfer Dt'
				,'Address Change Date'
				,'1099R Media'
				,'TX RTN MAILING RULE'
				,'MN State ID'
				,'Depre. Schedule'
				,'Mon Send To'
				,'Qtrly Send To'
				,'SAnn Send To'
				,'Ann Send To'
				,'Mon Client Recipient'
				,'Qtr Client Recipient'
				,'SA Client Recipient'
				,'Ann Client Recipient'
				,'Label Logo'
				,'Mon Perf Summary'
				,'SA Perf Summary'
				,'Mon Portfolio App'
				,'SA Portfolio App'
				,'PO Start Date'
				,'PO End Date'
				,'QAS Start Date'
				,'Fiscal Year End'
				)
		)


INSERT INTO TBL_PolicyCategory (
	PolicyCategoryID
	,FullName
	,Description
	)
SELECT PolicyCategoryID
	,FullName
	,Description
FROM $(ExcelsiorDB)..PolicyCategory
WHERE PolicyCategoryID IN (
		SELECT DISTINCT PolicyCategoryID
		FROM $(ExcelsiorDB)..PolicyDimension
WHERE FULLNAME IN ('Maturity Dist Policy') )

-- [TBL_PolicyDimension] Migration Script
INSERT INTO [TBL_PolicyDimension]
SELECT PolicyDimensionID
	,replace(FullName, 'Logo on Payments', 'Logo on Beneficiary Payments') AS FullName
	,DataType
	,MaxPolicyLevel
	,CASE 
		WHEN FullName IN (
				 'Logo on Envelopes'
				,'Envelopes'
				,'Logo on Payments'
				,'Tax Pmt Mail Inst.'
				,'Address on Payments'
				)
			THEN 1
		ELSE PolicyCategoryID
		END
	,replace(Description, 'Logo on Payments', 'Logo on Beneficiary Payments') AS Description
FROM $(ExcelsiorDB)..PolicyDimension
WHERE FullName IN ('Maturity Dist Policy')

INSERT INTO [TBL_PolicyDropDown]
SELECT PolicyDropDownID
	,PolicyDimensionID
	,Replace(DropDownText, 'KCO Envelopes', 'KCo Envelopes')
	,Replace(Description, 'KCO Envelopes', 'KCo Envelopes')
FROM $(ExcelsiorDB)..PolicyDropDown
WHERE policydimensionid IN (
		SELECT PolicyDimensionID
		FROM TBL_PolicyDimension WHERE Fullname IN ('Maturity Dist Policy')
		)

SET IDENTITY_INSERT TBL_PolicyItem ON

INSERT INTO TBL_PolicyItem (
	PolicyItemId
	,PolicyDimensionId
	,PolicyLevel
	,OwnerId
	,NumericValue
	,TextValue
	,LogicalValue
	,DateValue
	,PolicyDropdownId
	,Comment
	,ModifiedDate
	,ModifiedUserId
	,CreatedDate
	,CreatedUserId
	,DeletedUserId
	)
SELECT PolicyItemId
	,PolicyDimensionId
	,PolicyLevel
	,clnt.BriefName
	,NumericValue
	,TextValue
	,LogicalValue
	,DateValue
	,PolicyDropdownId
	,Comment
	,getdate()
	,1
	,getdate()
	,1
	,NULL
FROM Excelsior_DB8_5..PolicyItem PItem
INNER JOIN Excelsior_DB8_5..CLIENT clnt on clnt.ClientId = PItem.OwnerID AND PItem.PolicyLevel = 100
WHERE POLICYDIMENSIONID IN (
		SELECT DISTINCT policydimensionid
		FROM TBL_PolicyDimension
		WHERE Fullname IN (
				'Client Name'
				,'TARP FCB Rollover'
				,'TARP Mkt Value Roll.'
				,'TARP Data Extract'
				,'Rpt Schedule'
				,'Mon Bene Rpt Prn set'
				,'Qtrly report copies'
				,'SAnn Ben Rpt Prnset'
				,'Ann Bene Rpt Copies'
				,'Ann Don Rpt Prn set'
				,'Mon Publish to Web'
				,'Qtr Publish to Web'
				,'SAnn Publish to Web'
				,'Ann Publish to Web'
				,'PIF Key Statistics'
				,'PIF Account History'
				,'PIF Unit Dec Prec'
				,'Payment Summary'
				,'Ann Acct History'
				,'Ann Alloc Summary'
				,'Ann Perf Summary'
				,'Per Perf Summary'
				,'Ann Portfolio App'
				,'Per Portfolio App'
				,'Cli Acct # on Rpts'
				,'Spigot Special Page'
				,'Min Req Dist (DAF)'
				,'Donor Advised Fund'
				,'Client Color Scheme'
				,'Client Logo'
				,'Client Contact'
				,'Mon DVD copies'
				,'Qtr DVD copies'
				,'SAnn DVD copies'
				,'No. of CD - Ann Rpt'
				,'Prior Period Adj'
				,'Custom label'
				,'TARP Prod. Cycle'
				,'TARP Calendar'
				,'CTS Production'
				,'Perf Net of Fees'
				,'Comp. Statistics Rpt'
				,'Exc from Rpt Medians'
				,'CTS Client Policy'
				,'PV Rpt by Acct Type'
				,'PV Rpt by Designatn'
				,'Retirement/Perpetual'
				,'Srt dt for perform.'
				,'Display Pmt Report'
				,'K-1 MAILING RULE'
				,'Trustee Change Date'
				,'Tax Return Ext. Date'
				,'Account Transfer Dt'
				,'Address Change Date'
				,'1099R Media'
				,'TX RTN MAILING RULE'
				,'MN State ID'
				,'Depre. Schedule'
				,'Mon Send To'
				,'Qtrly Send To'
				,'SAnn Send To'
				,'Ann Send To'
				,'Label Logo'
				,'Mon Perf Summary'
				,'SA Perf Summary'
				,'Mon Portfolio App'
				,'SA Portfolio App'
				,'PO Start Date'
				,'PO End Date'
				,'QAS Start Date'
				,'Fiscal Year End'
				)
		)
	AND PolicyItemId NOT IN (
		SELECT DISTINCT policyitemid
		FROM tbl_policyitem
		)
		
INSERT INTO TBL_PolicyItem (
	PolicyItemId
	,PolicyDimensionId
	,PolicyLevel
	,OwnerID
	,NumericValue
	,TextValue
	,LogicalValue
	,DateValue
	,PolicyDropdownId
	,Comment
	,ModifiedDate
	,ModifiedUserId
	,CreatedDate
	,CreatedUserId
	,DeletedUserId
	)
SELECT PolicyItemId
	,PolicyDimensionId
	,PolicyLevel
	,substring(pgm.BriefName,1,15)
	,NumericValue
	,TextValue
	,LogicalValue
	,DateValue
	,PolicyDropdownId
	,Comment
	,getdate()
	,1
	,getdate()
	,1
	,NULL
FROM Excelsior_DB8_5..PolicyItem PItem
INNER JOIN Excelsior_DB8_5..Program pgm on pgm.ProgramID = PItem.OwnerID AND PItem.PolicyLevel = 200
WHERE POLICYDIMENSIONID IN (
		SELECT DISTINCT policydimensionid
		FROM TBL_PolicyDimension
		WHERE Fullname IN (
				'Client Name'
				,'TARP FCB Rollover'
				,'TARP Mkt Value Roll.'
				,'TARP Data Extract'
				,'Rpt Schedule'
				,'Mon Bene Rpt Prn set'
				,'Qtrly report copies'
				,'SAnn Ben Rpt Prnset'
				,'Ann Bene Rpt Copies'
				,'Ann Don Rpt Prn set'
				,'Mon Publish to Web'
				,'Qtr Publish to Web'
				,'SAnn Publish to Web'
				,'Ann Publish to Web'
				,'PIF Key Statistics'
				,'PIF Account History'
				,'PIF Unit Dec Prec'
				,'Payment Summary'
				,'Ann Acct History'
				,'Ann Alloc Summary'
				,'Ann Perf Summary'
				,'Per Perf Summary'
				,'Ann Portfolio App'
				,'Per Portfolio App'
				,'Cli Acct # on Rpts'
				,'Spigot Special Page'
				,'Min Req Dist (DAF)'
				,'Donor Advised Fund'
				,'Client Color Scheme'
				,'Client Logo'
				,'Client Contact'
				,'Mon DVD copies'
				,'Qtr DVD copies'
				,'SAnn DVD copies'
				,'No. of CD - Ann Rpt'
				,'Prior Period Adj'
				,'Custom label'
				,'TARP Prod. Cycle'
				,'TARP Calendar'
				,'CTS Production'
				,'Perf Net of Fees'
				,'Comp. Statistics Rpt'
				,'Exc from Rpt Medians'
				,'CTS Client Policy'
				,'PV Rpt by Acct Type'
				,'PV Rpt by Designatn'
				,'Retirement/Perpetual'
				,'Srt dt for perform.'
				,'Display Pmt Report'
				,'K-1 MAILING RULE'
				,'Trustee Change Date'
				,'Tax Return Ext. Date'
				,'Account Transfer Dt'
				,'Address Change Date'
				,'1099R Media'
				,'TX RTN MAILING RULE'
				,'MN State ID'
				,'Depre. Schedule'
				,'Mon Send To'
				,'Qtrly Send To'
				,'SAnn Send To'
				,'Ann Send To'
				,'Label Logo'
				,'Mon Perf Summary'
				,'SA Perf Summary'
				,'Mon Portfolio App'
				,'SA Portfolio App'
				,'PO Start Date'
				,'PO End Date'
				,'QAS Start Date'
				,'Fiscal Year End'
				)
		)
	AND PolicyItemId NOT IN (
		SELECT DISTINCT policyitemid
		FROM tbl_policyitem
		)
		
INSERT INTO TBL_PolicyItem (
	PolicyItemId
	,PolicyDimensionId
	,PolicyLevel
	,OwnerID
	,NumericValue
	,TextValue
	,LogicalValue
	,DateValue
	,PolicyDropdownId
	,Comment
	,ModifiedDate
	,ModifiedUserId
	,CreatedDate
	,CreatedUserId
	,DeletedUserId
	)
SELECT PolicyItemId
	,PolicyDimensionId
	,PolicyLevel
	,acc.ADVENTID
	,NumericValue
	,TextValue
	,LogicalValue
	,DateValue
	,PolicyDropdownId
	,Comment
	,getdate()
	,1
	,getdate()
	,1
	,NULL
FROM Excelsior_DB8_5..PolicyItem PItem
INNER JOIN Excelsior_DB8_5..V_EIS_EX_ACCOUNT acc on acc.ACCOUNTID = PItem.OwnerID AND PItem.PolicyLevel = 300
WHERE POLICYDIMENSIONID IN (
		SELECT DISTINCT policydimensionid
		FROM TBL_PolicyDimension
		WHERE Fullname IN (
				'Client Name'
				,'TARP FCB Rollover'
				,'TARP Mkt Value Roll.'
				,'TARP Data Extract'
				,'Rpt Schedule'
				,'Mon Bene Rpt Prn set'
				,'Qtrly report copies'
				,'SAnn Ben Rpt Prnset'
				,'Ann Bene Rpt Copies'
				,'Ann Don Rpt Prn set'
				,'Mon Publish to Web'
				,'Qtr Publish to Web'
				,'SAnn Publish to Web'
				,'Ann Publish to Web'
				,'PIF Key Statistics'
				,'PIF Account History'
				,'PIF Unit Dec Prec'
				,'Payment Summary'
				,'Ann Acct History'
				,'Ann Alloc Summary'
				,'Ann Perf Summary'
				,'Per Perf Summary'
				,'Ann Portfolio App'
				,'Per Portfolio App'
				,'Cli Acct # on Rpts'
				,'Spigot Special Page'
				,'Min Req Dist (DAF)'
				,'Donor Advised Fund'
				,'Client Color Scheme'
				,'Client Logo'
				,'Client Contact'
				,'Mon DVD copies'
				,'Qtr DVD copies'
				,'SAnn DVD copies'
				,'No. of CD - Ann Rpt'
				,'Prior Period Adj'
				,'Custom label'
				,'TARP Prod. Cycle'
				,'TARP Calendar'
				,'CTS Production'
				,'Perf Net of Fees'
				,'Comp. Statistics Rpt'
				,'Exc from Rpt Medians'
				,'CTS Client Policy'
				,'PV Rpt by Acct Type'
				,'PV Rpt by Designatn'
				,'Retirement/Perpetual'
				,'Srt dt for perform.'
				,'Display Pmt Report'
				,'K-1 MAILING RULE'
				,'Trustee Change Date'
				,'Tax Return Ext. Date'
				,'Account Transfer Dt'
				,'Address Change Date'
				,'1099R Media'
				,'TX RTN MAILING RULE'
				,'MN State ID'
				,'Depre. Schedule'
				,'Mon Send To'
				,'Qtrly Send To'
				,'SAnn Send To'
				,'Ann Send To'
				,'Label Logo'
				,'Mon Perf Summary'
				,'SA Perf Summary'
				,'Mon Portfolio App'
				,'SA Portfolio App'
				,'PO Start Date'
				,'PO End Date'
				,'QAS Start Date'
				,'Fiscal Year End'
				)
		)
	AND PolicyItemId NOT IN (
		SELECT DISTINCT policyitemid
		FROM tbl_policyitem
		)

INSERT INTO TBL_PolicyItem (
	PolicyItemId
	,PolicyDimensionId
	,PolicyLevel
	,OwnerID
	,NumericValue
	,TextValue
	,LogicalValue
	,DateValue
	,PolicyDropdownId
	,Comment
	,ModifiedDate
	,ModifiedUserId
	,CreatedDate
	,CreatedUserId
	,DeletedUserId
	)
SELECT PolicyItemId
      ,PolicyDimensionId
      ,PolicyLevel
      ,clnt.BriefName
      ,CliEmp.SubContactId
      ,TextValue
      ,LogicalValue
      ,DateValue
      ,PolicyDropdownId
      ,Comment
      ,getdate()
      ,1
      ,getdate()
      ,1
      ,NULL
from Excelsior_DB8_5..PolicyItem PItem 
INNER JOIN Excelsior_DB8_5..CLIENT clnt on clnt.clientid = PItem.OwnerID AND PItem.PolicyLevel = 100
INNER JOIN ExcelsiorInnotrust_MappingDB8_5..TBL_ClientEmployeeLookup CliEmp ON CliEmp.employeeid = PItem.numericvalue and clnt.clientid = CliEmp.clientid
where POLICYDIMENSIONID in 
(select POLICYDIMENSIONID from Excelsior_DB8_5..PolicyDimension
where FullName in ('Mon Client Recipient'
                        ,'Qtr Client Recipient'
                        ,'SA Client Recipient'
                        ,'Ann Client Recipient'))
                        
INSERT INTO TBL_PolicyItem (
	PolicyItemId
	,PolicyDimensionId
	,PolicyLevel
	,OwnerID
	,NumericValue
	,TextValue
	,LogicalValue
	,DateValue
	,PolicyDropdownId
	,Comment
	,ModifiedDate
	,ModifiedUserId
	,CreatedDate
	,CreatedUserId
	,DeletedUserId
	)
SELECT PolicyItemId
      ,PolicyDimensionId
      ,PolicyLevel
      ,substring(pgm.BriefName,1,15)
      ,CliEmp.SubContactId
      ,TextValue
      ,LogicalValue
      ,DateValue
      ,PolicyDropdownId
      ,Comment
      ,getdate()
      ,1
      ,getdate()
      ,1
      ,NULL
from Excelsior_DB8_5..PolicyItem PItem 
INNER JOIN Excelsior_DB8_5..Program pgm on pgm.ProgramID = PItem.OwnerID AND PItem.PolicyLevel = 200
INNER JOIN ExcelsiorInnotrust_MappingDB8_5..TBL_ClientEmployeeLookup CliEmp ON CliEmp.employeeid = PItem.numericvalue and pgm.clientid = CliEmp.clientid
where POLICYDIMENSIONID in 
(select POLICYDIMENSIONID from Excelsior_DB8_5..PolicyDimension
where FullName in ('Mon Client Recipient'
                        ,'Qtr Client Recipient'
                        ,'SA Client Recipient'
                        ,'Ann Client Recipient'))
                        
INSERT INTO TBL_PolicyItem (
	PolicyItemId
	,PolicyDimensionId
	,PolicyLevel
	,OwnerID
	,NumericValue
	,TextValue
	,LogicalValue
	,DateValue
	,PolicyDropdownId
	,Comment
	,ModifiedDate
	,ModifiedUserId
	,CreatedDate
	,CreatedUserId
	,DeletedUserId
	)
SELECT PolicyItemId
      ,PolicyDimensionId
      ,PolicyLevel
      ,acc.ADVENTID
      ,CliEmp.SubContactId
      ,TextValue
      ,LogicalValue
      ,DateValue
      ,PolicyDropdownId
      ,Comment
      ,getdate()
      ,1
      ,getdate()
      ,1
      ,NULL
from Excelsior_DB8_5..PolicyItem PItem 
INNER JOIN Excelsior_DB8_5..V_EIS_EX_ACCOUNT acc on acc.ACCOUNTID = PItem.OwnerID AND PItem.PolicyLevel = 300
INNER JOIN ExcelsiorInnotrust_MappingDB8_5..TBL_ClientEmployeeLookup CliEmp ON CliEmp.employeeid = PItem.numericvalue and acc.clientid = CliEmp.clientid
where POLICYDIMENSIONID in 
(select POLICYDIMENSIONID from Excelsior_DB8_5..PolicyDimension
where FullName in ('Mon Client Recipient'
                        ,'Qtr Client Recipient'
                        ,'SA Client Recipient'
                        ,'Ann Client Recipient'))

INSERT INTO TBL_PolicyItem (
	PolicyItemId
	,PolicyDimensionId
	,PolicyLevel
	,OwnerID
	,NumericValue
	,TextValue
	,LogicalValue
	,DateValue
	,PolicyDropdownId
	,Comment
	,ModifiedDate
	,ModifiedUserId
	,CreatedDate
	,CreatedUserId
	,DeletedUserId
	)
SELECT PolicyItemId
	,PolicyDimensionId
	,PolicyLevel
	,acc.ADVENTID
	,NumericValue
	,TextValue
	,LogicalValue
	,DateValue
	,PolicyDropdownId
	,Comment
	,getdate()
	,1
	,getdate()
	,1
	,NULL
FROM $(ExcelsiorDB)..PolicyItem PItem
INNER JOIN $(ExcelsiorDB)..V_EIS_EX_ACCOUNT acc on acc.ACCOUNTID = PItem.OwnerID AND PItem.PolicyLevel = 300
WHERE POLICYDIMENSIONID IN (
		SELECT DISTINCT policydimensionid
		FROM TBL_PolicyDimension
		WHERE Fullname IN ('Maturity Dist Policy')
		)
	AND PolicyItemId NOT IN (
		SELECT DISTINCT policyitemid
		FROM tbl_policyitem
		)
		
SET IDENTITY_INSERT TBL_PolicyItem OFF