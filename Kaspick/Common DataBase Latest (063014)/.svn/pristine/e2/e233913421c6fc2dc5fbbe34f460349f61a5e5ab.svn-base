IF EXISTS (SELECT *
           FROM   sysobjects 
           WHERE  type = 'P'
                  AND name = 'USP_EX_GetPolicyItemExits')
    BEGIN
        DROP PROCEDURE USP_EX_GetPolicyItemExits;
        PRINT 'DROPPED USP_EX_GetPolicyItemExits';
    END
GO
    
/******************************************************************************          
** New Name : USP_EX_GetPolicyItemExits
** Old Name:  USP_EIS_EX_POLICY_ITEM_EXITS           
** Short Desc: To retrieve dimension values from POLICYITEM table.         
**          
** Full Description: To check the policy whether it is existing in POLICYITEM table for    
**     a particular OWNER   
**    
  @ENTITYTYPE      : POLICYLEVEL for which these POLICYITEMS going tobe fetched.    
  @ENTITYID        : OWNERID for which these POLICYITEMS are going tobe fetched.    
    
** Sample Call   
 DECLARE @COUNT INT   
  set  @COUNT = 0  
        EXEC USP_EX_GetPolicyItemExits    
   @ENTITYID=200033,          
   @ENTITYTYPE='CLIENT',    
   @POLICYNAME='Chk Req TA 2 Thres',  
   @COUNT = @COUNT output    
select @COUNT  
**          
** Return values: NONE          
**          
**          
** Standard declarations          
**       SET LOCK_TIMEOUT         30000   -- 30 seconds          
**           
** Created By: Tanuj Gupta         
** Company   : Kaspick & Company          
** Project   : Excelsior    
** Created DT: 06/25/2007    
**                      
*******************************************************************************    
**       Change History          
*******************************************************************************    
** Date:        Author:  Bug #     Description:                           Rvwd    
** --------     -------- ------    -------------------------------------- --------    
** 3-Apr-2014   Yugandhar  EXCREQ   7.4
** 23/05/2014	Mallikarjun		SP Name Renamed and Formatted
*******************************************************************************          
** Copyright (C) <CopyrightYear,,Year> Kaspick & Company, All Rights Reserved          
** COMPANY CONFIDENTIAL -- NOT FOR DISTRIBUTION          
*******************************************************************************/    
    
CREATE PROCEDURE USP_EX_GetPolicyItemExits    
(    
 @ENTITYID      CHAR(15),    
 @ENTITYTYPE    VARCHAR(20),    
 @POLICYNAME VARCHAR(50),  
 @COUNT   INT OUTPUT  
)    
AS    
BEGIN  
DECLARE @POLICY_LEVEL INT,   
  @POLICYDIMENSIONID INT   
  
  
SET @POLICY_LEVEL =(CASE WHEN @ENTITYTYPE = 'MANAGER' THEN  100  
       WHEN @ENTITYTYPE = 'ALLIANCE' THEN  200    
       WHEN @ENTITYTYPE = 'ACCOUNT' THEN  300  
     END)   
  
 SELECT  
   @POLICYDIMENSIONID = POLICYDIMENSIONID FROM TBL_PolicyDimension   
 WHERE  
  FULLNAME =  @POLICYNAME  
  
 SET @COUNT =(SELECT COUNT(*) FROM TBL_PolicyItem   
     WHERE OwnerID=@ENTITYID AND POLICYDIMENSIONID = @POLICYDIMENSIONID AND POLICYLEVEL=@POLICY_LEVEL)  
   
END

GO
  IF EXISTS (	SELECT *
			FROM sysobjects
			WHERE type = 'P'
			AND name = 'USP_EX_GetPolicyItemExits') 
	BEGIN
			PRINT 'CREATED PROCEDURE USP_EX_GetPolicyItemExits';
	END  