IF EXISTS (
		SELECT *
		FROM sysobjects
		WHERE type = 'P'
			AND NAME = 'USP_EX_GetSyaadminBenereportcommentsAcctactiveVal'
		)
BEGIN
	DROP PROCEDURE USP_EX_GetSyaadminBenereportcommentsAcctactiveVal;

	PRINT 'DROPPED USP_EX_GetSyaadminBenereportcommentsAcctactiveVal';
END
GO

/******************************************************************************      
** Name: USP_EX_GetSyaadminBenereportcommentsAcctactiveVal   
   
   Old Name : USP_EIS_EX_SYSADMIN_BENEREPORTCOMMENTS_ACCTACTIVE_ValSelProc  
    
** Short Desc: SP WRITTEN TO CHECK ACCOUNT STATUS   
**      
** Full Description      
**        THIS SP HELPS TO CHECK FOR THE STATUS OF ACCOUNT FOR THE RESPECTIVE COMMENTS.      
**      
** Sample Call      
        Exec USP_EIS_EX_SYSADMIN_BENEREPORTCOMMENTS_ACCTACTIVE_ValSelProc @XMLDATA = '<ROOT><ITEM><COMMENTID>205</COMMENTID></ITEM></ROOT>', @XPATH = '/ROOT/ITEM'      
**      
** Return values: NONE      
**      
**      
** Standard declarations      
**       SET LOCK_TIMEOUT         30000   -- 30 seconds      
**       
** Created By: N.R.AMARNATH      
** Company   : Kaspick & Company      
** Project   : Excelsior -- IM PROFILE      
** Created DT: 03/12/2007      
**                  
*******************************************************************************      
**       Change History      
*******************************************************************************      
** Date:        Author:  Bug #     Description:                           Rvwd      
** --------     -------- ------    -------------------------------------- --------      
** <mm/dd/yyyy>   
** 5/13/2014   Sanath        Delete option in Investment management description   
** 22-MAY-2014 Mallikarjun     SP Name Renamed and Formatted
*******************************************************************************      
** Copyright (C) <CopyrightYear,,Year> Kaspick & Company, All Rights Reserved      
** COMPANY CONFIDENTIAL -- NOT FOR DISTRIBUTION      
*******************************************************************************/
CREATE PROCEDURE [dbo].[USP_EX_GetSyaadminBenereportcommentsAcctactiveVal] (
	@xmldata VARCHAR(max)
	,@xpath VARCHAR(50)
	)
AS
--  Initial Set statements  --    
--SET NOCOUNT ON;    
--SET LOCK_TIMEOUT                30000;   -- 30 seconds    
--SET TRANSACTION ISOLATION LEVEL SNAPSHOT;    
--  Variable Declarations  --    
DECLARE @procname VARCHAR(60);
DECLARE @ErrorMessage VARCHAR(1000);
DECLARE @ErrorNumber INT;
-- Variables used for error handling -     
DECLARE @val1 VARCHAR(Max);
DECLARE @val2 VARCHAR(30);

--  Temp tables, Cursors, Table Variables  --    
--  Variable Data Assignment  --    
SET @procname = 'USP_EX_GetSyaadminBenereportcommentsAcctactiveVal';

BEGIN TRY
	BEGIN
		DECLARE @hdoc INT
		DECLARE @tab TABLE (commentid INT)
		DECLARE @count_result INT

		EXEC SP_XML_PREPAREDOCUMENT @hdoc OUTPUT
			,@xmldata

		INSERT INTO @tab (commentid)
		SELECT *
		FROM OPENXML(@hdoc, @xpath, 2) WITH (commentid INT)

		SET @count_result = (
				SELECT count(*)
				FROM TBL_BR_CommentLinkage cl
				INNER JOIN VW_EX_ACCOUNT DGVIEW ON cl.CustomerAccountNumber = dgview.ACCOUNTID
				WHERE cl.CommentID IN (
						SELECT commentid
						FROM @tab
						)
					AND dgview.ACCOUNT_STATUS = - 1
				)

		IF @count_result > 0
			SELECT 'true' [STATUS]
		ELSE
			SELECT 'false' [STATUS]

		EXEC SP_XML_REMOVEDOCUMENT @HDOC
	END
END TRY

BEGIN CATCH
	SET @ErrorMessage = ERROR_MESSAGE();
	SET @ErrorNumber = ERROR_NUMBER();
	SET @val1 = Cast(@XMLDATA AS VARCHAR(MAX));
	SET @val2 = Cast(@XPATH AS VARCHAR(30));

	EXEC USP_EX_SYSErrorHandler @codename = @procname
		,@ErrorMessage = @ErrorMessage
		,@ErrorNumber = @ErrorNumber
		,@val1 = @val1
		,@val1str = 'XMLDATA '
		,@val2 = @val2
		,@val2str = 'XPATH';
END CATCH
GO

IF EXISTS (
		SELECT *
		FROM sysobjects
		WHERE type = 'P'
			AND NAME = 'USP_EX_GetSyaadminBenereportcommentsAcctactiveVal'
		)
BEGIN
	PRINT 'CREATED USP_EX_GetSyaadminBenereportcommentsAcctactiveVal';
END