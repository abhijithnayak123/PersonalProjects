IF EXISTS (SELECT *
           FROM   sysobjects 
           WHERE  type = 'P'
                  AND name = 'USP_EX_GetAccountProfileDetails')
    BEGIN
        DROP PROCEDURE USP_EX_GetAccountProfileDetails;
        PRINT 'DROPPED USP_EX_GetAccountProfileDetails';
    END
GO

/***************************************************************                    
** Name : USP_EX_GetAccountProfileDetails
** Old Name:     Did'nt Exist                
** Short Desc: To get account profile in account-investment-account profile details           
**                    
** Full Description: To get account profile in account-investment-account profile details          
**                            
** Input Arguments: CustomerAccountNo  
**       
** Sample Call                    
**  EXEC USP_EX_GetAccountProfileDetails  
   @ObjectiveCode = '352L418'  
     
**           
** Return values: NONE  
**                    
**                    
** Standard declarations                    
**       SET LOCK_TIMEOUT         30000   -- 30 seconds                    
**                     
** Created By: Mallikarjun
** Company   : Opteamix                   
** Project   : Excelsior Prime
** Created DT: 19/Apr/2014                 
**                                
*******************************************************************************              
**       Change History                    
*******************************************************************************              
** Date:        Author:  Bug #     Description:                           Rvwd              
** --------  -------- ------    -------------------------------------- --------              
** <MM/DD/YYYY>  
**04/22/2014  Mallikarjun  INVREQ2.2 Created for Account-Investment-AccountProfile tab
** 23/05/2014	Mallikarjun		SP Name Renamed and Formatted
*******************************************************************************                    
** Copyright (C) <CopyrightYear,,Year> Kaspick & Company, All Rights Reserved                    
** COMPANY CONFIDENTIAL -- NOT FOR DISTRIBUTION                    
*******************************************************************************/     
             
CREATE PROCEDURE [dbo].[USP_EX_GetAccountProfileDetails]--'ACENDW'--'352L418'
(  
 @CustomerAccountNo char(14)
)  
AS              
BEGIN 

Declare @HORIZON FLOAT
Declare @HORIZONSTR VARCHAR(20)
SET @HORIZON=0

DECLARE @AsOnDate DATE
SELECT @AsOnDate=GETDATE()

EXEC USP_EX_CalculateExpectedHorizon 
@CustomerAccountNo,
@AsOnDate,
@HORIZON  output


IF(@HORIZON=0 OR @HORIZON IS NULL)
	BEGIN
		SET @HORIZONSTR='Could not Calc'
	END
ELSE
	BEGIN
		SET @HORIZONSTR=@HORIZON
	END

SELECT AccMstr.CustomerDescriptionLine1 AS AccountName,CtAccDtls.PAYOUTPERCENTAGE AS UniTrustPerc,CtAccDtls.CYDistAmount AS AnnuityAmt,
@HORIZONSTR AS ExpectedHorizon,
 CASE UdfAccMstr.UDFAMColumn006 
 WHEN 'Y' THEN 'Yes' WHEN 'N' THEN 'No' END AS FlipProvision,PreCloseDate As AccountNotificationDate, AccMstr.ClosedDate As AccountClosureDate,
UdfAccMstr.UDFAMColumn030 AS MatureDate, UdfAccMstr.UDFAMColumn035 AS UpiaDesc
,UdfAccMstr.UDFAMColumn014 AS IncludeSGD,UdfAccMstr.UDFAMColumn012 AS IncludeLGD,UdfAccMstr.UDFAMColumn015 AS IncludeSTG,
UdfAccMstr.UDFAMColumn013 AS IncludeLTG,UdfAccMstr.UDFAMColumn038 AS RealizedSTGLTG,UdfAccMstr.UDFAMColumn016 AS PostGiftGain
FROM SYN_IT_AccountMaster AccMstr
INNER JOIN SYN_IT_ContactMaster ConMstr ON AccMstr.OwnerContactID=ConMstr.CONTACTID
INNER JOIN SYN_IT_CTAccountDetails CtAccDtls ON AccMstr.CustomerAccountNumber=CtAccDtls.CustomerAccountNumber
INNER JOIN SYN_IT_UDF_AccountMaster UdfAccMstr ON AccMstr.CustomerAccountNumber=UdfAccMstr.CustomerAccountNumber_Key
LEFT JOIN SYN_IT_AccountCloseSettings AccCloseStngs ON AccMstr.CustomerAccountNumber=AccCloseStngs.CustomerAccountNumber
WHERE AccMstr.CustomerAccountNumber=@CustomerAccountNo
	
END
GO
IF EXISTS (SELECT *
           FROM   sysobjects 
           WHERE  type = 'P'
                  AND name = 'USP_EX_GetAccountProfileDetails')
    BEGIN
       
        PRINT 'CREATED USP_EX_GetAccountProfileDetails';
    END 