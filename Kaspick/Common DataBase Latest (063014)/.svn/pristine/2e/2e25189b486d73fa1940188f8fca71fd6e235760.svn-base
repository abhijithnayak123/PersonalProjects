IF EXISTS (
		SELECT Object_ID
		FROM sys.objects
		WHERE NAME = 'USP_IE_RethrowError'
			AND type = 'p'
		)
	DROP PROCEDURE [dbo].[USP_IE_RethrowError]
GO

SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

/******************************************************************************  
** Name:     USP_IE_RethrowError  
** Short Desc: Used for throwing errors to application  

** Created By: Aashay Thodar  
** Company   : Kaspick & Company  
** Project   : Income Estimation  
** Created DT: 6/19/2014 
**              
*******************************************************************************  
**       Change History  
*******************************************************************************  
** Date:        Author:  Bug #     Description:                           Rvwd  
** --------     -------- ------    -------------------------------------- --------  
** 6/19/2014   
*******************************************************************************  
** Copyright (C) <CopyrightYear,,Year> Kaspick & Company, All Rights Reserved  
** COMPANY CONFIDENTIAL -- NOT FOR DISTRIBUTION  
*******************************************************************************/
CREATE PROCEDURE [dbo].[USP_IE_RethrowError]
AS
/* Return if there is no error information to retrieve. */
IF ERROR_NUMBER() IS NULL
	RETURN;

DECLARE @ErrorMessage NVARCHAR(4000)
	,@ErrorNumber INT
	,@ErrorSeverity INT
	,@ErrorState INT
	,@ErrorLine INT
	,@ErrorProcedure NVARCHAR(200);

/* Assign variables to error-handling functions that
       capture information for RAISERROR. */
SELECT @ErrorNumber = ERROR_NUMBER()
	,@ErrorSeverity = ERROR_SEVERITY()
	,@ErrorState = ERROR_STATE()
	,@ErrorLine = ERROR_LINE()
	,@ErrorProcedure = ISNULL(ERROR_PROCEDURE(), '-');

/* Building the message string that will contain original
       error information. */
SELECT @ErrorMessage = N'Error %d, Level %d, State %d, Procedure %s, Line %d, ' + 'Message: ' + ERROR_MESSAGE();

/* Raise an error: msg_str parameter of RAISERROR will contain
	   the original error information. */
RAISERROR (
		@ErrorMessage
		,@ErrorSeverity
		,1
		,@ErrorNumber
		,/* parameter: original error number. */
		@ErrorSeverity
		,/* parameter: original error severity. */
		@ErrorState
		,/* parameter: original error state. */
		@ErrorProcedure
		,/* parameter: original error procedure name. */
		@ErrorLine /* parameter: original error line number. */
		);
